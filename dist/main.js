(()=>{"use strict";var e={77(e,o,r){Object.defineProperty(o,"__esModule",{value:!0}),o.planStructures=function(e){Memory.planning||(Memory.planning={plannedStructures:[],spawnSquareRoadAnchorPositions:[],currentStage:1});const o=Memory.planning;if(void 0===o.currentStage&&(o.currentStage=1),o.plannedStructures||(o.plannedStructures=[]),o.spawnSquareRoadAnchorPositions||(o.spawnSquareRoadAnchorPositions=[]),1===o.currentStage){const r=e.find(FIND_MY_SPAWNS);if(r.length>0){const n=r[0],s=[{dx:-2,dy:0},{dx:2,dy:0},{dx:0,dy:-2},{dx:0,dy:2},{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];let a=0;for(const r of s){const s=new RoomPosition(n.pos.x+r.dx,n.pos.y+r.dy,e.name);(0,t.addPlannedStructure)(o.plannedStructures,s,STRUCTURE_ROAD,"to_build",e)&&(o.spawnSquareRoadAnchorPositions.push(s),a++)}a>0&&console.log(`Planner: Stage 1 - Planned ${a} roads.`)}const n=o.plannedStructures.filter(e=>e.structureType===STRUCTURE_ROAD&&o.spawnSquareRoadAnchorPositions.some(o=>o.x===e.pos.x&&o.y===e.pos.y));n.length>0&&n.every(e=>"built"===e.status)&&(console.log("Planner: Stage 1 Complete. Advancing to Stage 2."),o.currentStage=2)}};const t=r(623)},119(e,o){Object.defineProperty(o,"__esModule",{value:!0}),o.runBuilder=function(e){if(e.memory.building&&0===e.store[RESOURCE_ENERGY]&&(e.memory.building=!1),e.memory.building||0!==e.store.getFreeCapacity()||(e.memory.building=!0),e.memory.building){const o=e.pos.findClosestByPath(FIND_MY_CONSTRUCTION_SITES);o?e.build(o)===ERR_NOT_IN_RANGE&&e.moveTo(o,{visualizePathStyle:{stroke:"#ffffff"}}):e.upgradeController(e.room.controller)===ERR_NOT_IN_RANGE&&e.moveTo(e.room.controller,{visualizePathStyle:{stroke:"#ffffff"}})}else{const o=e.room.storage;if(o&&o.store.getUsedCapacity(RESOURCE_ENERGY)>0)return void(e.withdraw(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(o));const r=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.store.getUsedCapacity(RESOURCE_ENERGY)>50});if(r)return void(e.withdraw(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(r));const t=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:e=>e.resourceType===RESOURCE_ENERGY&&e.amount>50});if(t)return void(e.pickup(t)===ERR_NOT_IN_RANGE&&e.moveTo(t));const n=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_LINK&&e.store.getUsedCapacity(RESOURCE_ENERGY)>0});if(n)return void(e.withdraw(n,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(n))}}},978(e,o,r){Object.defineProperty(o,"__esModule",{value:!0}),o.runHarvester=function(e){const o=e.room;if(0===e.getActiveBodyparts(CARRY))return console.log(`${e.name}: ERRO FATAL - Creep sem CARRY part! Suicidando para renascer correto.`),void e.suicide();if(!e.memory.sourceId){const r=o.find(FIND_SOURCES),n=_.filter(r,e=>(0,t.isSourceSafe)(e));if(n.length>0){const r=_.filter(Game.creeps,r=>r.room.name===o.name&&"harvester"===r.memory.role&&r.name!==e.name);for(const o of n)if(_.filter(r,e=>e.memory.sourceId===o.id).length<2){e.memory.sourceId=o.id,console.log(`${e.name}: AtribuÃ­do ao source ${o.id}`);break}}}const r=Game.getObjectById(e.memory.sourceId);if(r)if(e.store.getFreeCapacity()>0)e.harvest(r)===ERR_NOT_IN_RANGE&&e.moveTo(r,{visualizePathStyle:{stroke:"#ffaa00"}});else{const r=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>(e.structureType===STRUCTURE_SPAWN||e.structureType===STRUCTURE_EXTENSION)&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0});r?e.transfer(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(r,{visualizePathStyle:{stroke:"#ffffff"}}):e.upgradeController(o.controller)===ERR_NOT_IN_RANGE&&e.moveTo(o.controller)}else delete e.memory.sourceId};const t=r(623)},594(e,o){Object.defineProperty(o,"__esModule",{value:!0}),o.runSupplier=function(e){const o=e.room;if(0===e.store.getUsedCapacity()){const r=o.find(FIND_SOURCES),t=o.find(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&r.some(o=>e.pos.inRangeTo(o,3))&&e.store.getUsedCapacity(RESOURCE_ENERGY)>0});if(t.length>0){const o=e.pos.findClosestByPath(t);o&&e.withdraw(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&(console.log(`${e.name}: Indo coletar de container em ${o.pos}`),e.moveTo(o))}else{const o=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:e=>e.resourceType===RESOURCE_ENERGY&&e.amount>50});o?e.pickup(o)===ERR_NOT_IN_RANGE&&(console.log(`${e.name}: Indo pegar drop em ${o.pos}`),e.moveTo(o)):console.log(`${e.name}: Nada para coletar.`)}}else{const o=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>(e.structureType===STRUCTURE_SPAWN||e.structureType===STRUCTURE_EXTENSION)&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0});o?e.transfer(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&(console.log(`${e.name}: Indo entregar em ${o.structureType}`),e.moveTo(o)):console.log(`${e.name}: Nada para entregar, aguardando.`)}}},180(e,o){Object.defineProperty(o,"__esModule",{value:!0}),o.runUpgrader=function(e){if(e.memory.upgrading&&0===e.store[RESOURCE_ENERGY]&&(e.memory.upgrading=!1),e.memory.upgrading||0!==e.store.getFreeCapacity()||(e.memory.upgrading=!0),e.memory.upgrading)e.upgradeController(e.room.controller)===ERR_NOT_IN_RANGE&&e.moveTo(e.room.controller,{visualizePathStyle:{stroke:"#ffffff"}});else{const o=e.room.controller.pos.findInRange(FIND_STRUCTURES,3,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.store.getUsedCapacity(RESOURCE_ENERGY)>0})[0];if(o)return void(e.withdraw(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(o));if(e.room.storage&&e.room.storage.store.getUsedCapacity(RESOURCE_ENERGY)>0)return void(e.withdraw(e.room.storage,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(e.room.storage));const r=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.store.getUsedCapacity(RESOURCE_ENERGY)>50});if(r)return void(e.withdraw(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(r));const t=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:e=>e.resourceType===RESOURCE_ENERGY&&e.amount>50});if(t)return void(e.pickup(t)===ERR_NOT_IN_RANGE&&e.moveTo(t))}}},623(e,o){function r(e,o){if(!e||!e.roomName||e.x<0||e.y<0||e.x>=50||e.y>=50)return!1;if(o.getTerrain().get(e.x,e.y)===TERRAIN_MASK_WALL)return!1;const r=o.lookAt(e);for(const e of r){if(e.structure&&e.structure.structureType!==STRUCTURE_ROAD)return!1;if(e.constructionSite&&e.constructionSite.structureType!==STRUCTURE_ROAD)return!1}return!0}Object.defineProperty(o,"__esModule",{value:!0}),o.isTerrainValidForRoad=r,o.addPlannedStructure=function(e,o,t,n="to_build",s){return!e.some(e=>e.pos.x===o.x&&e.pos.y===o.y&&e.structureType===t)&&!!r(o,s)&&(e.push({pos:o,structureType:t,status:n}),!0)},o.findClosestAnchor=function(e,o){if(0===o.length)return null;let r=null,t=1/0;for(const n of o){const o=e.getRangeTo(n);o<t&&(t=o,r=n)}return r},o.isSourceSafe=function(e){return!(e.pos.findInRange(FIND_HOSTILE_CREEPS,5).length>0)&&!(e.pos.findInRange(FIND_HOSTILE_STRUCTURES,5,{filter:e=>e.owner&&"Invader"!==e.owner.username&&"Source Keeper"!==e.owner.username}).length>0)}}},o={};function r(t){var n=o[t];if(void 0!==n)return n.exports;var s=o[t]={exports:{}};return e[t](s,s.exports,r),s.exports}var t={};(()=>{var e=t;Object.defineProperty(e,"__esModule",{value:!0}),e.loop=void 0;const o=r(77),n=r(978),s=r(594),a=r(119),i=r(180);console.log("--- GEMINI DEPLOY: v17 (Body Parts Fix) ---"),e.loop=function(){Game.time%1e3==0&&console.log(`--- TICK: ${Game.time} ---`);for(const e in Memory.creeps)Game.creeps[e]||delete Memory.creeps[e];let e=Object.values(Game.rooms)[0];if(!e){const o=Object.values(Game.spawns);o.length>0&&(e=o[0].room)}if(!e)return;if((0,o.planStructures)(e),Memory.planning&&Memory.planning.plannedStructures)for(const e of Memory.planning.plannedStructures){if("built"===e.status)continue;const o=new RoomPosition(e.pos.x,e.pos.y,e.pos.roomName);o.lookFor(LOOK_STRUCTURES).some(o=>o.structureType===e.structureType)?e.status="built":e.status=o.lookFor(LOOK_CONSTRUCTION_SITES).length>0?"building":"to_build"}if(Memory.planning&&Memory.planning.plannedStructures){const o=Memory.planning.plannedStructures.filter(e=>"to_build"===e.status);for(const r of o)e.createConstructionSite(r.pos.x,r.pos.y,r.structureType)}const r=e.find(FIND_MY_SPAWNS)[0];if(r&&!r.spawning){const o=_.filter(Game.creeps,o=>o.room.name===e.name);_.filter(o,e=>"harvester"===e.memory.role).length<2&&e.energyAvailable>=200?r.spawnCreep([WORK,CARRY,MOVE],"Harvester"+Game.time,{memory:{role:"harvester"}})===OK&&console.log("Main: Spawning Harvester (Fixed Body)"):_.filter(o,e=>"builder"===e.memory.role).length<2&&e.find(FIND_MY_CONSTRUCTION_SITES).length>0&&e.energyAvailable>=200&&r.spawnCreep([WORK,CARRY,MOVE],"Builder"+Game.time,{memory:{role:"builder"}})}for(const e in Game.creeps){const o=Game.creeps[e];if(!o.spawning)try{"harvester"===o.memory.role?(0,n.runHarvester)(o):"builder"===o.memory.role?(0,a.runBuilder)(o):"supplier"===o.memory.role?(0,s.runSupplier)(o):"upgrader"===o.memory.role&&(0,i.runUpgrader)(o)}catch(e){console.log(`Error running creep ${o.name}: ${e}`)}}}})();var n=exports;for(var s in t)n[s]=t[s];t.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();