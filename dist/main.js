(()=>{"use strict";var e={77(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.planStructures=function(e){Memory.planning||(Memory.planning={plannedStructures:[],spawnSquareRoadAnchorPositions:[],currentStage:1});const t=Memory.planning;void 0===t.currentStage&&(t.currentStage=1),t.plannedStructures||(t.plannedStructures=[]),t.spawnSquareRoadAnchorPositions||(t.spawnSquareRoadAnchorPositions=[]);const r=t.currentStage;if(console.log(`Planner Stage: ${r}`),1===r){const r=e.find(FIND_MY_SPAWNS);if(r.length>0){const n=r[0],s=[{dx:-2,dy:0},{dx:2,dy:0},{dx:0,dy:-2},{dx:0,dy:2},{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];let u=0;for(const r of s){const s=new RoomPosition(n.pos.x+r.dx,n.pos.y+r.dy,e.name);(0,o.addPlannedStructure)(t.plannedStructures,s,STRUCTURE_ROAD,"to_build",e)&&(t.spawnSquareRoadAnchorPositions.push(s),u++)}u>0&&console.log(`Planner: Stage 1 - Planned ${u} more roads for the diamond.`)}const n=t.plannedStructures.filter(e=>e.structureType===STRUCTURE_ROAD&&t.spawnSquareRoadAnchorPositions.some(t=>t.x===e.pos.x&&t.y===e.pos.y));n.length>0&&n.every(e=>"built"===e.status)&&(console.log("Planner: Stage 1 (Diamond) Complete. Advancing to Stage 2."),t.currentStage=2)}};const o=r(623)},119(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.runBuilder=function(e){if(e.memory.building&&0===e.store[RESOURCE_ENERGY]&&(e.memory.building=!1),e.memory.building||0!==e.store.getFreeCapacity()||(e.memory.building=!0),e.memory.building){const t=e.pos.findClosestByPath(FIND_MY_CONSTRUCTION_SITES);t&&e.build(t)===ERR_NOT_IN_RANGE&&e.moveTo(t)}else{const t=e.pos.findClosestByPath(FIND_SOURCES);t&&e.harvest(t)===ERR_NOT_IN_RANGE&&e.moveTo(t)}}},978(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.runHarvester=function(e){if(e.store.getFreeCapacity()>0){const t=e.pos.findClosestByPath(FIND_SOURCES);t&&e.harvest(t)===ERR_NOT_IN_RANGE&&e.moveTo(t)}else{const t=e.pos.findClosestByPath(FIND_MY_SPAWNS);t&&e.transfer(t,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(t)}}},594(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.runSupplier=function(e){if(0===e.store.getUsedCapacity()){const t=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.store[RESOURCE_ENERGY]>0});t&&e.withdraw(t,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(t)}else{const t=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>(e.structureType===STRUCTURE_SPAWN||e.structureType===STRUCTURE_EXTENSION)&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0});t&&e.transfer(t,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(t)}}},623(e,t){function r(e,t){if(!e||!e.roomName||e.x<0||e.y<0||e.x>=50||e.y>=50)return!1;if("wall"===Game.map.getTerrainAt(e.x,e.y,t.name))return!1;const r=t.lookAt(e);for(const e of r){if(e.structure&&e.structure.structureType!==STRUCTURE_ROAD)return!1;if(e.constructionSite&&e.constructionSite.structureType!==STRUCTURE_ROAD)return!1}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.isTerrainValidForRoad=r,t.addPlannedStructure=function(e,t,o,n="to_build",s){return!e.some(e=>e.pos.x===t.x&&e.pos.y===t.y&&e.structureType===o)&&!!r(t,s)&&(e.push({pos:t,structureType:o,status:n}),!0)},t.findClosestAnchor=function(e,t){if(0===t.length)return null;let r=null,o=1/0;for(const n of t){const t=e.getRangeTo(n);t<o&&(o=t,r=n)}return r}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,r),s.exports}var o={};(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0}),e.loop=void 0,console.log("--- GEMINI DEPLOY: v5 (Stage 1 Diamond & Built Check) ---");const t=r(77),n=r(978),s=r(594),u=r(119);e.loop=function(){for(const e in Memory.creeps)Game.creeps[e]||delete Memory.creeps[e];const e=Object.values(Game.rooms)[0];if(!e)return;if((0,t.planStructures)(e),Memory.planning&&Memory.planning.plannedStructures)for(const e of Memory.planning.plannedStructures){if("built"===e.status)continue;const t=new RoomPosition(e.pos.x,e.pos.y,e.pos.roomName);t.lookFor(LOOK_STRUCTURES).some(t=>t.structureType===e.structureType)?(e.status="built",console.log(`Main: Structure ${e.structureType} built at ${e.pos.x},${e.pos.y}`)):t.lookFor(LOOK_CONSTRUCTION_SITES).some(t=>t.structureType===e.structureType)?e.status="building":"building"===e.status&&(e.status="to_build")}if(Memory.planning&&Memory.planning.plannedStructures){const t=Memory.planning.plannedStructures.filter(e=>"to_build"===e.status);for(const r of t)e.createConstructionSite(r.pos.x,r.pos.y,r.structureType)===OK&&(r.status="building",console.log(`Main: Created CS for ${r.structureType} at ${r.pos.x},${r.pos.y}`))}const r=e.find(FIND_MY_SPAWNS)[0];if(r&&!r.spawning&&e.energyAvailable>=200){const t=_.filter(Game.creeps,t=>t.room.name===e.name);_.filter(t,e=>"harvester"===e.memory.role).length<2?r.spawnCreep([WORK,CARRY,MOVE],"Harvester"+Game.time,{memory:{role:"harvester"}}):_.filter(t,e=>"builder"===e.memory.role).length<2&&e.find(FIND_MY_CONSTRUCTION_SITES).length>0&&r.spawnCreep([WORK,CARRY,MOVE],"Builder"+Game.time,{memory:{role:"builder"}})}for(const e in Game.creeps){const t=Game.creeps[e];"harvester"===t.memory.role&&(0,n.runHarvester)(t),"builder"===t.memory.role&&(0,u.runBuilder)(t),"supplier"===t.memory.role&&(0,s.runSupplier)(t)}}})();var n=exports;for(var s in o)n[s]=o[s];o.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();