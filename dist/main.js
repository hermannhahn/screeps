(()=>{"use strict";var e={77(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.planStructures=function(e){Memory.planning||(Memory.planning={plannedStructures:[],spawnSquareRoadAnchorPositions:[],currentStage:1});const o=Memory.planning;void 0===o.currentStage&&(o.currentStage=1),o.plannedStructures||(o.plannedStructures=[]),o.spawnSquareRoadAnchorPositions||(o.spawnSquareRoadAnchorPositions=[]);const t=o.currentStage,n=e.find(FIND_MY_CONSTRUCTION_SITES),s=e.find(FIND_SOURCES).filter(e=>!(0,r.isSourceSafe)(e));if(o.plannedStructures=o.plannedStructures.filter(o=>{if(o.pos.roomName!==e.name&&t<7)return!1;const r=new RoomPosition(o.pos.x,o.pos.y,o.pos.roomName);return!s.some(e=>r.inRangeTo(e,10))}),1===t){const t=e.find(FIND_MY_SPAWNS);if(t.length>0){const n=t[0],s=[{dx:-2,dy:0},{dx:2,dy:0},{dx:0,dy:-2},{dx:0,dy:2},{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];for(const t of s){const s=new RoomPosition(n.pos.x+t.dx,n.pos.y+t.dy,e.name);(0,r.addPlannedStructure)(o.plannedStructures,s,STRUCTURE_ROAD,"to_build",e)&&o.spawnSquareRoadAnchorPositions.push(s)}}const s=o.plannedStructures.filter(t=>t.pos.roomName===e.name&&t.structureType===STRUCTURE_ROAD&&o.spawnSquareRoadAnchorPositions.some(e=>e.x===t.pos.x&&e.y===t.pos.y));s.length>0&&s.every(e=>"built"===e.status)&&0===n.length&&(o.currentStage=2)}if(2===t){const t=e.find(FIND_MY_SPAWNS)[0];if(!t)return;const s=5;if(o.plannedStructures.filter(o=>o.pos.roomName===e.name&&o.structureType===STRUCTURE_EXTENSION).length+e.find(FIND_MY_STRUCTURES,{filter:{structureType:STRUCTURE_EXTENSION}}).length<s)for(const n of o.spawnSquareRoadAnchorPositions){if(o.plannedStructures.filter(o=>o.pos.roomName===e.name&&o.structureType===STRUCTURE_EXTENSION).length>=s)break;const a=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];for(const i of a){const a=new RoomPosition(n.x+i.dx,n.y+i.dy,n.roomName);if(e.getTerrain().get(a.x,a.y)!==TERRAIN_MASK_WALL&&!a.isEqualTo(t.pos)&&!o.plannedStructures.some(e=>e.pos.x===a.x&&e.pos.y===a.y)&&(0,r.addPlannedStructure)(o.plannedStructures,a,STRUCTURE_EXTENSION,"to_build",e)&&o.plannedStructures.filter(o=>o.pos.roomName===e.name&&o.structureType===STRUCTURE_EXTENSION).length>=s)break}}const a=o.plannedStructures.filter(o=>o.pos.roomName===e.name&&o.structureType===STRUCTURE_EXTENSION);a.length>=5&&a.every(e=>"built"===e.status)&&0===n.length&&(o.currentStage=3)}if(3===t){const t=e.find(FIND_SOURCES).filter(e=>(0,r.isSourceSafe)(e)),s=o.spawnSquareRoadAnchorPositions.map(e=>new RoomPosition(e.x,e.y,e.roomName));for(const n of t)if(!o.plannedStructures.some(o=>{const t=new RoomPosition(o.pos.x,o.pos.y,o.pos.roomName);return o.pos.roomName===e.name&&o.structureType===STRUCTURE_ROAD&&t.isNearTo(n.pos)})){const t=(0,r.findClosestAnchor)(n.pos,s);if(t){const s=PathFinder.search(n.pos,{pos:t,range:1},{plainCost:2,swampCost:10,roomCallback:e=>{let o=new PathFinder.CostMatrix;const t=Game.rooms[e];return t&&t.find(FIND_STRUCTURES).forEach(e=>{e.structureType!==STRUCTURE_ROAD&&o.set(e.pos.x,e.pos.y,255)}),o}}).path;for(const t of s)(0,r.addPlannedStructure)(o.plannedStructures,t,STRUCTURE_ROAD,"to_build",e)}}const a=o.plannedStructures.filter(t=>t.pos.roomName===e.name&&t.structureType===STRUCTURE_ROAD&&!o.spawnSquareRoadAnchorPositions.some(e=>e.x===t.pos.x&&e.y===t.pos.y));a.length>0&&a.every(e=>"built"===e.status)&&0===n.length&&(o.currentStage=4)}if(4===t){if(e.controller){const t=o.spawnSquareRoadAnchorPositions.map(e=>new RoomPosition(e.x,e.y,e.roomName)),n=(0,r.findClosestAnchor)(e.controller.pos,t);if(n){const t=PathFinder.search(e.controller.pos,{pos:n,range:1},{plainCost:2,swampCost:10}).path;for(const n of t)(0,r.addPlannedStructure)(o.plannedStructures,n,STRUCTURE_ROAD,"to_build",e)}}0===o.plannedStructures.filter(t=>t.pos.roomName===e.name&&"built"!==t.status&&!o.spawnSquareRoadAnchorPositions.some(e=>e.x===t.pos.x&&e.y===t.pos.y)&&t.structureType===STRUCTURE_ROAD).length&&0===n.length&&(o.currentStage=6)}if(6===t){const t=e.find(FIND_SOURCES).filter(e=>(0,r.isSourceSafe)(e));for(const n of t)if(!(e.find(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.pos.inRangeTo(n,2)}).length>0||o.plannedStructures.some(o=>o.pos.roomName===e.name&&o.structureType===STRUCTURE_CONTAINER&&new RoomPosition(o.pos.x,o.pos.y,o.pos.roomName).inRangeTo(n,2)))){const t=o.plannedStructures.find(o=>o.pos.roomName===e.name&&o.structureType===STRUCTURE_ROAD&&new RoomPosition(o.pos.x,o.pos.y,o.pos.roomName).isNearTo(n.pos));if(t){const n=new RoomPosition(t.pos.x,t.pos.y,t.pos.roomName);(0,r.addPlannedStructure)(o.plannedStructures,n,STRUCTURE_CONTAINER,"to_build",e)}}if(e.controller&&!(e.find(FIND_STRUCTURES,{filter:o=>o.structureType===STRUCTURE_CONTAINER&&o.pos.inRangeTo(e.controller,3)}).length>0||o.plannedStructures.some(o=>o.pos.roomName===e.name&&o.structureType===STRUCTURE_CONTAINER&&new RoomPosition(o.pos.x,o.pos.y,o.pos.roomName).inRangeTo(e.controller,3)))){const t=[{dx:1,dy:1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:-1,dy:-1}];for(const n of t){const t=new RoomPosition(e.controller.pos.x+n.dx,e.controller.pos.y+n.dy,e.name);if(e.getTerrain().get(t.x,t.y)!==TERRAIN_MASK_WALL&&!o.plannedStructures.some(e=>e.pos.x===t.x&&e.pos.y===t.y)&&(0,r.addPlannedStructure)(o.plannedStructures,t,STRUCTURE_CONTAINER,"to_build",e))break}}const s=o.plannedStructures.filter(o=>o.pos.roomName===e.name&&o.structureType===STRUCTURE_CONTAINER);0!==s.length&&!s.every(e=>"built"===e.status)||0!==n.length||(console.log("Planner: Stage 6 Complete. Advancing to Stage 7."),o.currentStage=7)}if(7===t){if(!Memory.remoteMining)return;const t=o.spawnSquareRoadAnchorPositions.map(e=>new RoomPosition(e.x,e.y,e.roomName));let n=!1;for(const s in Memory.remoteMining){const a=Memory.remoteMining[s];if(Game.time%10==0&&console.log(`Planner Stage 7 Diagnostic: Room=${s}, Hostile=${a.isHostile}, PosSaved=${!!a.sourcePositions}`),!a.isHostile&&a.sourcePositions)for(const i of a.sourcePositions){const a=new RoomPosition(i.x,i.y,s);if(!o.plannedStructures.some(e=>{const o=new RoomPosition(e.pos.x,e.pos.y,e.pos.roomName);return e.pos.roomName===s&&e.structureType===STRUCTURE_ROAD&&o.isNearTo(a)})){const m=(0,r.findClosestAnchor)(a,t);if(m){const t=PathFinder.search(a,{pos:m,range:1},{plainCost:2,swampCost:10,roomCallback:e=>{const t=new PathFinder.CostMatrix;return o.plannedStructures.forEach(o=>{o.pos.roomName===e&&o.structureType===STRUCTURE_ROAD&&t.set(o.pos.x,o.pos.y,1)}),t}});if(t.path.length>0)for(const s of t.path)(0,r.addPlannedStructure)(o.plannedStructures,s,STRUCTURE_ROAD,"to_build",e)&&(n=!0);else Game.time%10==0&&console.log(`Planner Stage 7: PathFinder found no path for ${s} source at ${i.x},${i.y}`)}}}}n&&console.log("Planner Stage 7: Planned remote source roads.")}if(8===t){if(!e.controller||e.controller.level<3)return;const t=e.find(FIND_MY_SPAWNS)[0];if(!t)return;if(!(e.find(FIND_MY_STRUCTURES,{filter:{structureType:STRUCTURE_TOWER}}).length>0||o.plannedStructures.some(o=>o.pos.roomName===e.name&&o.structureType===STRUCTURE_TOWER))){const n=[{dx:0,dy:-3},{dx:0,dy:3},{dx:-3,dy:0},{dx:3,dy:0}];for(const s of n){const n=new RoomPosition(t.pos.x+s.dx,t.pos.y+s.dy,e.name);if((0,r.addPlannedStructure)(o.plannedStructures,n,STRUCTURE_TOWER,"to_build",e))break}}}};const r=t(623)},551(e,o){Object.defineProperty(o,"__esModule",{value:!0}),o.manageRemoteMining=function(e){Memory.remoteMining||(Memory.remoteMining={});const o=Game.map.describeExits(e.name);o&&Object.values(o).forEach(e=>{Memory.remoteMining[e]||(Memory.remoteMining[e]={sources:[],reserverNeeded:!1,isHostile:!1,lastScouted:0})})},o.getRemoteSpawnRequest=function(e){if(!Memory.remoteMining)return null;for(const o in Memory.remoteMining){const t=Memory.remoteMining[o],r=_.filter(Game.creeps,e=>e.memory.targetRoom===o),n=t.isHostile?5e4:1e4;if(Game.time-t.lastScouted>n&&_.filter(r,e=>"scout"===e.memory.role).length<1)return{role:"scout",targetRoom:o};if(t.isHostile||0===t.sources.length)continue;const s=_.filter(r,e=>"remoteHarvester"===e.memory.role);if(s.length<t.sources.length)return{role:"remoteHarvester",targetRoom:o};if(t.reserverNeeded&&e.controller&&e.controller.level>=3&&_.filter(r,e=>"reserver"===e.memory.role).length<1)return{role:"reserver",targetRoom:o};if(_.filter(r,e=>"remoteCarrier"===e.memory.role).length<2*s.length)return{role:"remoteCarrier",targetRoom:o}}return null}},119(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.runBuilder=function(e){if(!(0,r.handleDefensiveState)(e)){if(e.memory.building&&0===e.store[RESOURCE_ENERGY]&&(e.memory.building=!1,delete e.memory.targetId),e.memory.building||0!==e.store.getFreeCapacity()||(e.memory.building=!0,delete e.memory.targetId),e.memory.targetId){const o=Game.getObjectById(e.memory.targetId);o&&0!==(0,r.getEnergyAmount)(o)||delete e.memory.targetId}if(e.memory.building){if(!e.memory.targetId){const o=e.pos.findClosestByPath(FIND_MY_CONSTRUCTION_SITES);o&&(e.memory.targetId=o.id)}if(e.memory.targetId){const o=Game.getObjectById(e.memory.targetId);o?e.build(o)===ERR_NOT_IN_RANGE?e.moveTo(o,{visualizePathStyle:{stroke:"#ffffff"},reusePath:10}):(0,r.sayAction)(e,"üî®"):delete e.memory.targetId}else e.upgradeController(e.room.controller)===ERR_NOT_IN_RANGE?e.moveTo(e.room.controller,{visualizePathStyle:{stroke:"#ffffff"},reusePath:10}):(0,r.sayAction)(e,"‚ö°")}else{if(!e.memory.targetId){const o=e.room.storage;if(o&&o.store[RESOURCE_ENERGY]>0&&(0,r.isTargetAvailable)(e,o)&&(e.memory.targetId=o.id),!e.memory.targetId){const o=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:o=>o.structureType===STRUCTURE_CONTAINER&&o.store[RESOURCE_ENERGY]>50&&(0,r.isTargetAvailable)(e,o)});o&&(e.memory.targetId=o.id)}if(!e.memory.targetId){const o=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:o=>o.resourceType===RESOURCE_ENERGY&&o.amount>50&&(0,r.isTargetAvailable)(e,o)});o&&(e.memory.targetId=o.id)}}if(e.memory.targetId){const o=Game.getObjectById(e.memory.targetId);o&&((o instanceof Resource?e.pickup(o):e.withdraw(o,RESOURCE_ENERGY))===ERR_NOT_IN_RANGE?e.moveTo(o,{visualizePathStyle:{stroke:"#ffaa00"},reusePath:10}):(0,r.sayAction)(e,"üì¶"))}else(0,r.sayAction)(e,"üí§")}}};const r=t(623)},978(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.runHarvester=function(e){if((0,r.handleDefensiveState)(e))return;const o=e.room;if(!e.memory.sourceId){const t=o.find(FIND_SOURCES),n=_.filter(t,e=>(0,r.isSourceSafe)(e));if(n.length>0){const t=_.filter(Game.creeps,t=>t.room.name===o.name&&"harvester"===t.memory.role&&t.name!==e.name);for(const o of n)if(_.filter(t,e=>e.memory.sourceId===o.id).length<2){e.memory.sourceId=o.id;break}}}const t=Game.getObjectById(e.memory.sourceId);if(t)if(e.store.getFreeCapacity()>0)e.harvest(t)===ERR_NOT_IN_RANGE?e.moveTo(t,{visualizePathStyle:{stroke:"#ffaa00"}}):(0,r.sayAction)(e,"‚õèÔ∏è");else if(0===_.filter(Game.creeps,e=>e.room.name===o.name&&"supplier"===e.memory.role&&!e.spawning).length){const t=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>(e.structureType===STRUCTURE_SPAWN||e.structureType===STRUCTURE_EXTENSION)&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0});t?e.transfer(t,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE?e.moveTo(t,{visualizePathStyle:{stroke:"#ffffff"}}):(0,r.sayAction)(e,"üì•"):e.upgradeController(o.controller)===ERR_NOT_IN_RANGE?e.moveTo(o.controller):(0,r.sayAction)(e,"‚ö°")}else{const o=e.pos.findInRange(FIND_MY_STRUCTURES,3,{filter:e=>e.structureType===STRUCTURE_LINK&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0})[0];if(o)e.transfer(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE?e.moveTo(o):(0,r.sayAction)(e,"üì•");else{const o=e.pos.findInRange(FIND_STRUCTURES,3,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0})[0];o?e.transfer(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE?e.moveTo(o):(0,r.sayAction)(e,"üì•"):((0,r.sayAction)(e,"üì¶"),e.drop(RESOURCE_ENERGY))}}else delete e.memory.sourceId};const r=t(623)},926(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.runRemoteCarrier=function(e){if(e.memory.targetRoom&&e.memory.homeRoom&&!(0,r.handleDefensiveState)(e)){if(Memory.remoteMining&&Memory.remoteMining[e.memory.targetRoom]&&Memory.remoteMining[e.memory.targetRoom].isHostile&&0===e.store.getUsedCapacity())return(0,r.sayAction)(e,"‚ö†Ô∏è"),void(0,r.travelToRoom)(e,e.memory.homeRoom);if(0===e.store.getUsedCapacity())if(e.room.name!==e.memory.targetRoom)(0,r.sayAction)(e,"üèÉ"),(0,r.travelToRoom)(e,e.memory.targetRoom);else{const o=e.pos.findClosestByRange(FIND_DROPPED_RESOURCES,{filter:e=>e.resourceType===RESOURCE_ENERGY&&e.amount>50});o&&(e.pickup(o)===ERR_NOT_IN_RANGE?e.moveTo(o):(0,r.sayAction)(e,"üì¶"))}else if(e.room.name!==e.memory.homeRoom)(0,r.sayAction)(e,"üí∞"),(0,r.travelToRoom)(e,e.memory.homeRoom);else{const o=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>(e.structureType===STRUCTURE_STORAGE||e.structureType===STRUCTURE_SPAWN||e.structureType===STRUCTURE_EXTENSION)&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0});o&&(e.transfer(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE?e.moveTo(o):(0,r.sayAction)(e,"üì•"))}}};const r=t(623)},292(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.runRemoteHarvester=function(e){if(e.memory.targetRoom&&!(0,r.handleDefensiveState)(e)){if(Memory.remoteMining&&Memory.remoteMining[e.memory.targetRoom]&&Memory.remoteMining[e.memory.targetRoom].isHostile)return(0,r.sayAction)(e,"‚ö†Ô∏è"),void(e.memory.homeRoom&&(0,r.travelToRoom)(e,e.memory.homeRoom));if(e.room.name!==e.memory.targetRoom)(0,r.sayAction)(e,"üöö"),(0,r.travelToRoom)(e,e.memory.targetRoom);else{if(!e.memory.sourceId){const o=e.room.find(FIND_SOURCES);o.length>0&&(e.memory.sourceId=o[0].id)}const o=Game.getObjectById(e.memory.sourceId);o&&(e.harvest(o)===ERR_NOT_IN_RANGE?e.moveTo(o,{visualizePathStyle:{stroke:"#ffaa00"}}):(0,r.sayAction)(e,"‚õèÔ∏è"))}}};const r=t(623)},648(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.runReserver=function(e){if(e.memory.targetRoom)if(e.room.name!==e.memory.targetRoom)(0,r.sayAction)(e,"üöÄ"),(0,r.travelToRoom)(e,e.memory.targetRoom);else{const o=e.room.controller;o&&(e.reserveController(o)===ERR_NOT_IN_RANGE?e.moveTo(o,{visualizePathStyle:{stroke:"#ffffff"}}):(0,r.sayAction)(e,"üîí"))}};const r=t(623)},70(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.runScout=function(e){const o=e.memory.targetRoom;if(o){if(e.room.name===o){if(0===e.pos.x)return void e.move(RIGHT);if(49===e.pos.x)return void e.move(LEFT);if(0===e.pos.y)return void e.move(BOTTOM);if(49===e.pos.y)return void e.move(TOP);(0,r.sayAction)(e,"‚úÖ"),Memory.remoteMining||(Memory.remoteMining={});const o=e.room.find(FIND_SOURCES),t=o.map(e=>e.id),n=o.map(e=>({x:e.pos.x,y:e.pos.y})),s=e.room.controller,a=e.room.find(FIND_HOSTILE_CREEPS).length>0,i=e.room.find(FIND_HOSTILE_STRUCTURES,{filter:e=>e.owner&&"Invader"!==e.owner.username&&"Source Keeper"!==e.owner.username}).length>0,m=!(!s||!s.owner||s.my),l=a||i||m;return void(Memory.remoteMining[e.room.name]={sources:t,sourcePositions:n,reserverNeeded:!!s&&!s.owner,isHostile:l,lastScouted:Game.time})}(0,r.sayAction)(e,"üî≠"),(0,r.travelToRoom)(e,o)}};const r=t(623)},594(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.runSupplier=function(e){if((0,r.handleDefensiveState)(e))return;const o=e.room;if(0!==e.getActiveBodyparts(WORK)){if(e.memory.targetId){const o=Game.getObjectById(e.memory.targetId);o&&0!==(0,r.getEnergyAmount)(o)?(0===e.store.getFreeCapacity()&&(o instanceof Resource||o instanceof StructureContainer||o instanceof StructureLink||o instanceof StructureStorage)||0===e.store.getUsedCapacity())&&delete e.memory.targetId:delete e.memory.targetId}if(0===e.store.getUsedCapacity()){if(!e.memory.targetId){const t=o.find(FIND_SOURCES),n=o.find(FIND_STRUCTURES,{filter:o=>(o.structureType===STRUCTURE_CONTAINER||o.structureType===STRUCTURE_LINK)&&t.some(e=>o.pos.inRangeTo(e,3))&&(0,r.isTargetAvailable)(e,o)});if(n.length>0){const o=e.pos.findClosestByPath(n);o&&(e.memory.targetId=o.id)}if(!e.memory.targetId){const o=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:o=>o.resourceType===RESOURCE_ENERGY&&(0,r.isTargetAvailable)(e,o)});o&&(e.memory.targetId=o.id)}!e.memory.targetId&&o.storage&&(0,r.isTargetAvailable)(e,o.storage)&&o.storage.store[RESOURCE_ENERGY]>500&&(e.memory.targetId=o.storage.id)}if(e.memory.targetId){const o=Game.getObjectById(e.memory.targetId);o&&((o instanceof Resource?e.pickup(o):e.withdraw(o,RESOURCE_ENERGY))===ERR_NOT_IN_RANGE?e.moveTo(o,{visualizePathStyle:{stroke:"#ffaa00"},reusePath:10}):(0,r.sayAction)(e,"üì¶"))}else(0,r.sayAction)(e,"üí§")}else{if(!e.memory.targetId){let t=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>(e.structureType===STRUCTURE_SPAWN||e.structureType===STRUCTURE_EXTENSION)&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0});if(!t){const r=o.find(FIND_SOURCES);t=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>{const o=e.structureType===STRUCTURE_CONTAINER,t=!r.some(o=>e.pos.inRangeTo(o,3));return o&&t&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0}})}t&&(e.memory.targetId=t.id)}if(e.memory.targetId){const o=Game.getObjectById(e.memory.targetId);o&&o.store&&o.store.getFreeCapacity(RESOURCE_ENERGY)>0?e.transfer(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE?e.moveTo(o,{visualizePathStyle:{stroke:"#ffffff"},reusePath:10}):(0,r.sayAction)(e,"üì•"):delete e.memory.targetId}else{const t=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>e.hits<e.hitsMax&&e.structureType!==STRUCTURE_WALL&&e.structureType!==STRUCTURE_RAMPART});if(t)return void(e.repair(t)===ERR_NOT_IN_RANGE?e.moveTo(t):(0,r.sayAction)(e,"üîß"));const n=e.pos.findClosestByPath(FIND_MY_CONSTRUCTION_SITES);if(n)return void(e.build(n)===ERR_NOT_IN_RANGE?e.moveTo(n):(0,r.sayAction)(e,"üî®"));e.upgradeController(o.controller)===ERR_NOT_IN_RANGE?e.moveTo(o.controller):(0,r.sayAction)(e,"‚ö°")}}}else e.suicide()};const r=t(623)},180(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.runUpgrader=function(e){if(!(0,r.handleDefensiveState)(e)){if(e.memory.upgrading&&0===e.store[RESOURCE_ENERGY]&&(e.memory.upgrading=!1,delete e.memory.targetId),e.memory.upgrading||0!==e.store.getFreeCapacity()||(e.memory.upgrading=!0,delete e.memory.targetId),e.memory.targetId){const o=Game.getObjectById(e.memory.targetId);o&&0!==(0,r.getEnergyAmount)(o)||delete e.memory.targetId}if(e.memory.upgrading)e.upgradeController(e.room.controller)===ERR_NOT_IN_RANGE?e.moveTo(e.room.controller,{visualizePathStyle:{stroke:"#ffffff"},reusePath:10}):(0,r.sayAction)(e,"‚ö°");else{if(!e.memory.targetId){const o=e.room.controller.pos.findInRange(FIND_STRUCTURES,3,{filter:o=>o.structureType===STRUCTURE_CONTAINER&&o.store[RESOURCE_ENERGY]>0&&(0,r.isTargetAvailable)(e,o)})[0];if(o&&(e.memory.targetId=o.id),!e.memory.targetId&&e.room.storage&&(0,r.isTargetAvailable)(e,e.room.storage)&&e.room.storage.store[RESOURCE_ENERGY]>0&&(e.memory.targetId=e.room.storage.id),!e.memory.targetId){const o=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:o=>o.structureType===STRUCTURE_CONTAINER&&o.store[RESOURCE_ENERGY]>50&&(0,r.isTargetAvailable)(e,o)});o&&(e.memory.targetId=o.id)}if(!e.memory.targetId){const o=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:o=>o.resourceType===RESOURCE_ENERGY&&o.amount>50&&(0,r.isTargetAvailable)(e,o)});o&&(e.memory.targetId=o.id)}}if(e.memory.targetId){const o=Game.getObjectById(e.memory.targetId);o&&((o instanceof Resource?e.pickup(o):e.withdraw(o,RESOURCE_ENERGY))===ERR_NOT_IN_RANGE?e.moveTo(o,{visualizePathStyle:{stroke:"#ffaa00"},reusePath:10}):(0,r.sayAction)(e,"üì¶"))}else{if(e.room.controller.level<=2){const o=e.pos.findClosestByPath(FIND_SOURCES,{filter:e=>e.energy>0});if(o)return void(e.harvest(o)===ERR_NOT_IN_RANGE?e.moveTo(o,{visualizePathStyle:{stroke:"#ffaa00"},reusePath:10}):(0,r.sayAction)(e,"‚õèÔ∏è"))}(0,r.sayAction)(e,"üí§")}}}};const r=t(623)},623(e,o){function t(e,o){return!(!e||!e.roomName||e.x<0||e.y<0||e.x>=50||e.y>=50)&&Game.map.getRoomTerrain(e.roomName).get(e.x,e.y)!==TERRAIN_MASK_WALL}function r(e){return e?e.store?e.store.getUsedCapacity(RESOURCE_ENERGY):e.amount?e.amount:0:0}function n(e,o){e.memory.lastAction!==o&&(e.say(o,!1),e.memory.lastAction=o)}Object.defineProperty(o,"__esModule",{value:!0}),o.isTerrainValidForRoad=t,o.addPlannedStructure=function(e,o,r,n="to_build",s){return!e.some(e=>e.pos.x===o.x&&e.pos.y===o.y&&e.pos.roomName===o.roomName&&e.structureType===r)&&!!t(o)&&(e.push({pos:{x:o.x,y:o.y,roomName:o.roomName},structureType:r,status:n}),!0)},o.findClosestAnchor=function(e,o){if(0===o.length)return null;let t=null,r=1/0;for(const n of o){let o;o=e.roomName===n.roomName?e.getRangeTo(n):50*Game.map.getRoomLinearDistance(e.roomName,n.roomName)+(Math.abs(e.x-n.x)+Math.abs(e.y-n.y)),o<r&&(r=o,t=n)}return t},o.isSourceSafe=function(e){return!(e.pos.findInRange(FIND_HOSTILE_CREEPS,10).length>0)&&!(e.pos.findInRange(FIND_HOSTILE_STRUCTURES,10,{filter:e=>e.owner&&"Invader"!==e.owner.username&&"Source Keeper"!==e.owner.username}).length>0)},o.generateBody=function(e,o){let t=[];if("harvester"===e||"remoteHarvester"===e){t.push(CARRY),t.push(MOVE);let e=o-100,r=Math.floor(e/100);r>6&&(r=6),r<1&&(r=1);for(let e=0;e<r;e++)t.push(WORK)}else if("supplier"===e||"remoteCarrier"===e){t.push(WORK);let e=o-100,r=Math.floor(e/100);r>15&&(r=15),r<1&&(r=1);for(let e=0;e<r;e++)t.push(CARRY),t.push(MOVE)}else if("reserver"===e){let e=Math.floor(o/650);e>2&&(e=2),e<1&&(e=1);for(let o=0;o<e;o++)t.push(CLAIM),t.push(MOVE)}else if("scout"===e)t=[MOVE];else{let e=Math.floor(o/200);e>15&&(e=15),e<1&&(e=1);for(let o=0;o<e;o++)t.push(WORK),t.push(CARRY),t.push(MOVE)}return t},o.getEnergyAmount=r,o.isTargetAvailable=function(e,o){if(!o)return!1;let t=r(o);if(t<=0)return!1;const n=_.filter(Game.creeps,t=>t.room.name===e.room.name&&t.id!==e.id&&t.memory.targetId===o.id);let s=0;for(const e of n)s+=e.store.getFreeCapacity(RESOURCE_ENERGY);return t-s>0},o.handleDefensiveState=function(e){const o=e.pos.findInRange(FIND_HOSTILE_CREEPS,5);if(o.length>0){n(e,"üèÉüí®"),delete e.memory.targetId,"harvester"===e.memory.role&&delete e.memory.sourceId;const t=o.map(e=>({pos:e.pos,range:10})),r=PathFinder.search(e.pos,t,{flee:!0,maxRooms:1,plainCost:2,swampCost:10,maxOps:500}).path;if(r.length>0)e.moveByPath(r);else{const t=e.pos.findClosestByRange(o);if(t){const o=(e.pos.getDirectionTo(t)+4)%8||8;e.move(o)}}return!0}return!1},o.sayAction=n,o.travelToRoom=function(e,o){if(e.room.name===o)return!1;const t=e.room.findExitTo(o);if(t!==ERR_NO_PATH&&t!==ERR_INVALID_ARGS){const o=e.pos.findClosestByRange(t);if(o)return e.moveTo(o,{visualizePathStyle:{stroke:"#ffffff"},reusePath:20}),!0}return!1}}},o={};function t(r){var n=o[r];if(void 0!==n)return n.exports;var s=o[r]={exports:{}};return e[r](s,s.exports,t),s.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.loop=void 0;const o=t(77),n=t(551),s=t(978),a=t(594),i=t(119),m=t(180),l=t(70),u=t(648),R=t(292),c=t(926),d=t(623);e.loop=function(){for(const e in Memory.creeps)Game.creeps[e]||delete Memory.creeps[e];const e=Object.values(Game.spawns)[0];let t=e?e.room:Object.values(Game.rooms)[0];if(!t)return void console.log("Main: No visible rooms or spawns found.");if(Memory.planning&&Memory.planning.plannedStructures)for(const e of Memory.planning.plannedStructures)if("built"!==e.status&&Game.rooms[e.pos.roomName]){const o=new RoomPosition(e.pos.x,e.pos.y,e.pos.roomName);if(o.lookFor(LOOK_STRUCTURES).some(o=>o.structureType===e.structureType)){e.status="built";continue}e.status=o.lookFor(LOOK_CONSTRUCTION_SITES).length>0?"building":"to_build"}if((0,o.planStructures)(t),(0,n.manageRemoteMining)(t),Memory.planning&&Memory.planning.plannedStructures){const e=Memory.planning.plannedStructures.filter(e=>"to_build"===e.status);for(const o of e){const e=Game.rooms[o.pos.roomName];e&&e.createConstructionSite(o.pos.x,o.pos.y,o.structureType)===OK&&(o.status="building")}}const r=t.find(FIND_MY_STRUCTURES,{filter:{structureType:STRUCTURE_TOWER}});for(const e of r){const o=e.pos.findClosestByRange(FIND_HOSTILE_CREEPS);if(o)e.attack(o);else{const o=e.pos.findClosestByRange(FIND_STRUCTURES,{filter:e=>e.hits<e.hitsMax&&e.structureType!==STRUCTURE_WALL&&e.structureType!==STRUCTURE_RAMPART});o&&e.repair(o)}}if(e&&!e.spawning){const o=_.filter(Game.creeps,e=>e.room.name===t.name||e.memory.homeRoom===t.name),r=_.filter(o,e=>"harvester"===e.memory.role),s=_.filter(o,e=>"supplier"===e.memory.role),a=_.filter(o,e=>"builder"===e.memory.role),i=_.filter(o,e=>"upgrader"===e.memory.role),m=t.find(FIND_SOURCES),l=_.filter(m,e=>(0,d.isSourceSafe)(e)),u=t.controller?t.controller.level:1,R=t.find(FIND_MY_CONSTRUCTION_SITES).length>0,c=2*l.length,f=Math.max(1,r.length+1),y=R?u<=2?2:1:0,p=u<=3?2:1,E=(0,n.getRemoteSpawnRequest)(t);let T,S=null;if(r.length<l.length?S="harvester":s.length<1?S="supplier":i.length<1?S="upgrader":E&&"scout"===E.role?(S="scout",T=E.targetRoom):r.length<c?S="harvester":a.length<y?S="builder":E?(S=E.role,T=E.targetRoom):s.length<f?S="supplier":i.length<p&&(S="upgrader"),S){const o=0===r.length?t.energyAvailable:t.energyCapacityAvailable,n=(0,d.generateBody)(S,o);let s=0;for(const e of n)s+=BODYPART_COST[e];if(t.energyAvailable>=s){const o=S.charAt(0).toUpperCase()+S.slice(1)+Game.time;e.spawnCreep(n,o,{memory:{role:S,targetRoom:T,homeRoom:t.name}})}}}for(const e in Game.creeps){const o=Game.creeps[e];if(!o.spawning)switch(o.memory.role){case"harvester":(0,s.runHarvester)(o);break;case"builder":(0,i.runBuilder)(o);break;case"supplier":(0,a.runSupplier)(o);break;case"upgrader":(0,m.runUpgrader)(o);break;case"scout":(0,l.runScout)(o);break;case"reserver":(0,u.runReserver)(o);break;case"remoteHarvester":(0,R.runRemoteHarvester)(o);break;case"remoteCarrier":(0,c.runRemoteCarrier)(o)}}}})();var n=exports;for(var s in r)n[s]=r[s];r.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();