(()=>{"use strict";var e={77(e,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.planStructures=function(e){Memory.planning||(Memory.planning={plannedStructures:[],spawnSquareRoadAnchorPositions:[],currentStage:1});const r=Memory.planning;if(void 0===r.currentStage&&(r.currentStage=1),r.plannedStructures||(r.plannedStructures=[]),r.spawnSquareRoadAnchorPositions||(r.spawnSquareRoadAnchorPositions=[]),1===r.currentStage){const o=e.find(FIND_MY_SPAWNS);if(o.length>0){const n=o[0],s=[{dx:-2,dy:0},{dx:2,dy:0},{dx:0,dy:-2},{dx:0,dy:2},{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];let R=0;for(const o of s){const s=new RoomPosition(n.pos.x+o.dx,n.pos.y+o.dy,e.name);(0,t.addPlannedStructure)(r.plannedStructures,s,STRUCTURE_ROAD,"to_build",e)&&(r.spawnSquareRoadAnchorPositions.push(s),R++)}R>0&&console.log(`Planner: Stage 1 - Planned ${R} roads.`)}const n=r.plannedStructures.filter(e=>e.structureType===STRUCTURE_ROAD&&r.spawnSquareRoadAnchorPositions.some(r=>r.x===e.pos.x&&r.y===e.pos.y));n.length>0&&n.every(e=>"built"===e.status)&&(console.log("Planner: Stage 1 Complete. Advancing to Stage 2."),r.currentStage=2)}};const t=o(623)},119(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.runBuilder=function(e){if(e.memory.building&&0===e.store[RESOURCE_ENERGY]&&(e.memory.building=!1),e.memory.building||0!==e.store.getFreeCapacity()||(e.memory.building=!0),e.memory.building){const r=e.pos.findClosestByPath(FIND_MY_CONSTRUCTION_SITES);r?e.build(r)===ERR_NOT_IN_RANGE&&e.moveTo(r,{visualizePathStyle:{stroke:"#ffffff"}}):e.upgradeController(e.room.controller)===ERR_NOT_IN_RANGE&&e.moveTo(e.room.controller,{visualizePathStyle:{stroke:"#ffffff"}})}else{const r=e.room.storage;if(r&&r.store.getUsedCapacity(RESOURCE_ENERGY)>0)return void(e.withdraw(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(r));const o=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.store.getUsedCapacity(RESOURCE_ENERGY)>50});if(o)return void(e.withdraw(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(o));const t=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:e=>e.resourceType===RESOURCE_ENERGY&&e.amount>50});if(t)return void(e.pickup(t)===ERR_NOT_IN_RANGE&&e.moveTo(t));const n=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_LINK&&e.store.getUsedCapacity(RESOURCE_ENERGY)>0});if(n)return void(e.withdraw(n,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(n))}}},978(e,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.runHarvester=function(e){const r=e.room;if(e.memory.sourceId&&(Game.getObjectById(e.memory.sourceId)||(console.log(`${e.name}: Source ${e.memory.sourceId} desapareceu. Resetando...`),delete e.memory.sourceId)),!e.memory.sourceId){const o=r.find(FIND_SOURCES),n=_.filter(o,e=>(0,t.isSourceSafe)(e));if(n.length>0){const o=_.filter(Game.creeps,o=>o.room.name===r.name&&"harvester"===o.memory.role&&o.name!==e.name);for(const r of n)if(_.filter(o,e=>e.memory.sourceId===r.id).length<2){e.memory.sourceId=r.id,console.log(`${e.name}: ATRIBUÃDO ao source ${r.id}`);break}}else console.log(`${e.name}: ERRO - Nenhum source SEGURO em range 5 encontrado!`)}if(!e.memory.sourceId)return;const o=Game.getObjectById(e.memory.sourceId);if(o)if(e.store.getFreeCapacity()>0)e.harvest(o)===ERR_NOT_IN_RANGE&&e.moveTo(o,{visualizePathStyle:{stroke:"#ffaa00"}});else if(0===_.filter(Game.creeps,e=>e.room.name===r.name&&"supplier"===e.memory.role).length){const o=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>(e.structureType===STRUCTURE_SPAWN||e.structureType===STRUCTURE_EXTENSION)&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0});o?e.transfer(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(o,{visualizePathStyle:{stroke:"#ffffff"}}):e.upgradeController(r.controller)===ERR_NOT_IN_RANGE&&e.moveTo(r.controller)}else{const r=e.pos.findInRange(FIND_MY_STRUCTURES,3,{filter:e=>e.structureType===STRUCTURE_LINK&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0})[0];if(r)e.transfer(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(r);else{const r=e.pos.findInRange(FIND_STRUCTURES,3,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0})[0];r?e.transfer(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(r):e.drop(RESOURCE_ENERGY)}}};const t=o(623)},594(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.runSupplier=function(e){const r=e.room;if(0===e.store.getUsedCapacity()){const o=r.find(FIND_SOURCES),t=r.find(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&o.some(r=>e.pos.inRangeTo(r,3))&&e.store.getUsedCapacity(RESOURCE_ENERGY)>0});if(t.length>0){const r=e.pos.findClosestByPath(t);return void(r&&e.withdraw(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(r))}if(r.storage){const o=r.find(FIND_MY_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_LINK&&e.pos.inRangeTo(r.storage,3)&&e.store.getUsedCapacity(RESOURCE_ENERGY)>0});if(o.length>0){const r=e.pos.findClosestByPath(o);return void(r&&e.withdraw(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(r))}}const n=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:e=>e.resourceType===RESOURCE_ENERGY&&e.amount>50});if(n)return void(e.pickup(n)===ERR_NOT_IN_RANGE&&e.moveTo(n))}else{let o=e.pos.findClosestByPath(FIND_MY_STRUCTURES,{filter:e=>(e.structureType===STRUCTURE_SPAWN||e.structureType===STRUCTURE_EXTENSION)&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0});if(!o){const t=r.find(FIND_SOURCES);o=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>{const r=e.structureType===STRUCTURE_CONTAINER,o=!t.some(r=>e.pos.inRangeTo(r,3));return r&&o&&e.store.getFreeCapacity(RESOURCE_ENERGY)>0}})}o?e.transfer(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(o):e.upgradeController(r.controller)===ERR_NOT_IN_RANGE&&e.moveTo(r.controller)}}},180(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.runUpgrader=function(e){if(e.memory.upgrading&&0===e.store[RESOURCE_ENERGY]&&(e.memory.upgrading=!1),e.memory.upgrading||0!==e.store.getFreeCapacity()||(e.memory.upgrading=!0),e.memory.upgrading)e.upgradeController(e.room.controller)===ERR_NOT_IN_RANGE&&e.moveTo(e.room.controller,{visualizePathStyle:{stroke:"#ffffff"}});else{const r=e.room.controller.pos.findInRange(FIND_STRUCTURES,3,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.store.getUsedCapacity(RESOURCE_ENERGY)>0})[0];if(r)return void(e.withdraw(r,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(r));if(e.room.storage&&e.room.storage.store.getUsedCapacity(RESOURCE_ENERGY)>0)return void(e.withdraw(e.room.storage,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(e.room.storage));const o=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_CONTAINER&&e.store.getUsedCapacity(RESOURCE_ENERGY)>50});if(o)return void(e.withdraw(o,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE&&e.moveTo(o));const t=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:e=>e.resourceType===RESOURCE_ENERGY&&e.amount>50});if(t)return void(e.pickup(t)===ERR_NOT_IN_RANGE&&e.moveTo(t))}}},623(e,r){function o(e,r){if(!e||!e.roomName||e.x<0||e.y<0||e.x>=50||e.y>=50)return!1;if("wall"===Game.map.getTerrainAt(e.x,e.y,r.name))return!1;const o=r.lookAt(e);for(const e of o){if(e.structure&&e.structure.structureType!==STRUCTURE_ROAD)return!1;if(e.constructionSite&&e.constructionSite.structureType!==STRUCTURE_ROAD)return!1}return!0}Object.defineProperty(r,"__esModule",{value:!0}),r.isTerrainValidForRoad=o,r.addPlannedStructure=function(e,r,t,n="to_build",s){return!e.some(e=>e.pos.x===r.x&&e.pos.y===r.y&&e.structureType===t)&&!!o(r,s)&&(e.push({pos:r,structureType:t,status:n}),!0)},r.findClosestAnchor=function(e,r){if(0===r.length)return null;let o=null,t=1/0;for(const n of r){const r=e.getRangeTo(n);r<t&&(t=r,o=n)}return o},r.isSourceSafe=function(e){return!(e.pos.findInRange(FIND_HOSTILE_CREEPS,5).length>0)&&!(e.pos.findInRange(FIND_HOSTILE_STRUCTURES,5).length>0)}}},r={};function o(t){var n=r[t];if(void 0!==n)return n.exports;var s=r[t]={exports:{}};return e[t](s,s.exports,o),s.exports}var t={};(()=>{var e=t;Object.defineProperty(e,"__esModule",{value:!0}),e.loop=void 0;const r=o(77),n=o(978),s=o(594),R=o(119),i=o(180),a=o(623);console.log("--- GEMINI DEPLOY: v12 (Debug Roles Execution) ---"),e.loop=function(){for(const e in Memory.creeps)Game.creeps[e]||delete Memory.creeps[e];const e=Object.values(Game.rooms)[0];if(!e)return;if((0,r.planStructures)(e),Memory.planning&&Memory.planning.plannedStructures)for(const e of Memory.planning.plannedStructures){if("built"===e.status)continue;const r=new RoomPosition(e.pos.x,e.pos.y,e.pos.roomName);r.lookFor(LOOK_STRUCTURES).some(r=>r.structureType===e.structureType)?e.status="built":e.status=r.lookFor(LOOK_CONSTRUCTION_SITES).length>0?"building":"to_build"}if(Memory.planning&&Memory.planning.plannedStructures){const r=Memory.planning.plannedStructures.filter(e=>"to_build"===e.status);for(const o of r)e.createConstructionSite(o.pos.x,o.pos.y,o.structureType)}const o=e.find(FIND_MY_SPAWNS)[0];if(o&&!o.spawning){const r=_.filter(Game.creeps,r=>r.room.name===e.name),t=_.filter(r,e=>"harvester"===e.memory.role),n=_.filter(r,e=>"supplier"===e.memory.role),s=_.filter(r,e=>"builder"===e.memory.role),R=_.filter(r,e=>"upgrader"===e.memory.role),i=e.find(FIND_SOURCES),E=_.filter(i,e=>(0,a.isSourceSafe)(e)),l=e.controller?e.controller.level:1,u=t[0],c=(u?_.filter(u.body,e=>e.type===WORK).length:0)<5?2*E.length:E.length,p=2*t.length,d=e.find(FIND_MY_CONSTRUCTION_SITES).length>0?l<=2?2:1:0,m=l<=3?2:1;t.length<c&&e.energyAvailable>=250?o.spawnCreep([WORK,WORK,MOVE],"Harvester"+Game.time,{memory:{role:"harvester"}}):n.length<p&&e.energyAvailable>=200?o.spawnCreep([CARRY,CARRY,MOVE,MOVE],"Supplier"+Game.time,{memory:{role:"supplier"}}):s.length<d&&e.energyAvailable>=250?o.spawnCreep([WORK,CARRY,MOVE,MOVE],"Builder"+Game.time,{memory:{role:"builder"}}):R.length<m&&e.energyAvailable>=250&&o.spawnCreep([WORK,CARRY,MOVE,MOVE],"Upgrader"+Game.time,{memory:{role:"upgrader"}})}for(const e in Game.creeps){const r=Game.creeps[e];if(!r.spawning)try{"harvester"===r.memory.role?(0,n.runHarvester)(r):"builder"===r.memory.role?(0,R.runBuilder)(r):"supplier"===r.memory.role?(0,s.runSupplier)(r):"upgrader"===r.memory.role&&(0,i.runUpgrader)(r)}catch(e){console.log(`Erro na role do creep ${r.name}: ${e}`)}}}})();var n=exports;for(var s in t)n[s]=t[s];t.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();